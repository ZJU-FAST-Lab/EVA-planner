<launch>
    <arg name="x" default="0" />
    <arg name="y" default="0" />
    <arg name="z" default="0.1" />
    <arg name="map_frame" default="world" />
    <!-- size of map, change the size in x, y, z according to your application -->
    <arg name="map_size_x" value="20.0"/>
    <arg name="map_size_y" value="20.0"/>
    <arg name="map_size_z" value="2.0"/>
    <arg name="init_x" value="0.0"/>
    <arg name="init_y" value="0.0"/>
    <arg name="init_z" value="0.4"/>
    <arg name="yaw" default="0" />
    <arg name="world_filepath" default="$(find jackal_gazebo)/worlds/jackal_race_top_down.world" />
    <arg name="scan_topic" default="front/scan"/>
    <arg name="pointcld_topic" default="/os1_cloud_node/points"/>
    <arg name="gazebo_odom_topic" default="/gazebo_p3d/odom"/>
    <arg name="ctrl_odom_topic" default="/gazebo_p3d/odom"/>

    <!-- Launch Gazebo with the specified world -->
    <include file="$(find gazebo_ros)/launch/empty_world.launch">
      <arg name="debug" value="0" />
      <arg name="gui" value="false" />
      <arg name="use_sim_time" value="true" />
      <arg name="world_name" value="$(arg world_filepath)" />
    </include>

    <node pkg="tf2_ros" type="static_transform_publisher" name="map_odom_transformer"
          args="0 0 0 0 0 0 1 map odom"/>

      <node pkg="tf2_ros" type="static_transform_publisher" name="world_map_transformer"
                args="0 0 0 0 0 0 1 world map"/>

      <!-- complete TF tree, must be consistent with jackal.gazebo p3d setting-->
      <node pkg="gazebo_p3d_utils" type="p3d_link_tf" name="link_map_to_base_link"  output="screen">
        <remap from="~input" to="$(arg gazebo_odom_topic)"/>
      </node>

    <!-- Spawn Jackal -->
    <include file="$(find jackal_gazebo)/launch/spawn_jackal.launch">
        <arg name="x" value="$(arg x)" />
        <arg name="y" value="$(arg y)" />
        <arg name="z" value="$(arg z)" />
        <arg name="yaw" value="$(arg yaw)" />
        <arg name="config" value="ouster_laser"/>
        <arg name="joystick" value="true" />
        <arg name="keyboard" default="false" />
        <arg name="enable_ekf" default="false" />
    </include>

    <!--- Run rviz using config inside package -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find ref_gvn_ros)/rviz/ref_gvn_dummy.rviz" />

  <!-- main algorithm params -->
  <include file="$(find plan_manage)/launch/planner_sim.xml">

    <arg name="map_size_x_" value="$(arg map_size_x)"/>
    <arg name="map_size_y_" value="$(arg map_size_y)"/>
    <arg name="map_size_z_" value="$(arg map_size_z)"/>
    <arg name="odometry_topic" value="$(arg ctrl_odom_topic)"/>

    <arg name="cloud_topic" value="$(arg pointcld_topic)"/>

    <!-- intrinsic params of the depth camera -->
    <arg name="cx" value="321.8554382324219"/>
    <arg name="cy" value="241.2396240234375"/>
    <arg name="fx" value="386.02557373046875"/>
    <arg name="fy" value="386.02557373046875"/>

    <!-- 1: use 3D Nav Goal to select goal  -->
    <!-- 2: use global waypoints below  -->
    <arg name="flight_type" value="1" />
  </include>
</launch>
